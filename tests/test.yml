---
- name: Test OrangeAd Mac Setup
  hosts: macos
  become: yes

  vars_files:
    - ../default.config.yml

  pre_tasks:
    - name: Include custom config
      include_vars: "{{ item }}"
      with_fileglob:
        - "../config.yml"
      when: item | length > 0

  roles:
    - role: geerlingguy.mac.homebrew
      tags: ['homebrew']
    - role: main
      tags: ['main']

  tasks:
    - import_tasks: ../roles/main/tasks/pyenv.yml
      when: configure_pyenv | default(true)
      tags: ['python']

    - import_tasks: ../roles/main/tasks/node.yml
      when: configure_node | default(true)
      tags: ['node']

    - import_tasks: ../roles/main/tasks/tailscale.yml
      when: configure_tailscale | default(true)
      tags: ['tailscale']

    - import_tasks: ../roles/main/tasks/xcode.yml
      when: configure_xcode | default(true)
      tags: ['xcode']

    - import_tasks: ../roles/main/tasks/ssh.yml
      when: configure_ssh | default(true)
      tags: ['ssh']

    - import_tasks: ../roles/main/tasks/firewall.yml
      when: configure_firewall | default(true)
      tags: ['firewall']

    - import_tasks: ../roles/main/tasks/monitoring.yml
      when: install_monitoring_tools | default(true)
      tags: ['monitoring']

    - import_tasks: ../roles/main/tasks/osx.yml
      when: configure_osx | default(true)
      tags: ['osx']
